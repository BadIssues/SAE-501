enable
P@ssw0rd
conf t
!
hostname EDGE2
!
enable secret P@ssw0rd
username admin privilege 15 secret P@ssw0rd
!
no ip domain-lookup
ip domain-name wsl2025.org
!
crypto key generate rsa modulus 2048
!
ip ssh version 2
!
track 20 interface GigabitEthernet0/1.200 line-protocol
!
interface Loopback0
description Provider-Independent-IP
ip address 191.4.157.34 255.255.255.240
no shutdown
exit
!
interface GigabitEthernet0/0
description TO-WANRTR-Gi0/1
no ip address
no shutdown
exit
!
interface GigabitEthernet0/0.15
description LINK-TO-WANRTR (VRF MAN)
encapsulation dot1Q 15
ip address 10.4.254.18 255.255.255.252
ip nat inside
ip ospf authentication message-digest
ip ospf message-digest-key 1 md5 P@ssw0rd
ip ospf network point-to-point
exit
!
interface GigabitEthernet0/0.16
description LINK-TO-WANRTR (VRF INET)
encapsulation dot1Q 16
ip address 31.4.126.13 255.255.255.252
ip nat outside
exit
!
interface GigabitEthernet0/1
description TO-CORESW2-Fe1/0/1
no ip address
no shutdown
exit
!
interface GigabitEthernet0/1.200
description LINK-TO-CORESW2 (VLAN200)
encapsulation dot1Q 200
ip address 10.4.254.5 255.255.255.252
ip nat inside
exit
!
interface GigabitEthernet0/1.300
description LINK-TO-EDGE2 via VLAN300
encapsulation dot1Q 300
ip address 10.4.254.10 255.255.255.252
ip nat inside
ip ospf authentication message-digest
ip ospf message-digest-key 1 md5 P@ssw0rd
exit
!
interface GigabitEthernet0/1.30
description DMZ-VLAN30
encapsulation dot1Q 30
ip address 217.4.160.252 255.255.255.0
ip nat inside
standby 30 ip 217.4.160.254
standby 30 priority 100
standby 30 preempt
standby 30 track 20 decrement 20
exit
!
interface GigabitEthernet0/2
description UNUSED
no ip address
shutdown
exit
!
interface GigabitEthernet0/3
description UNUSED
no ip address
shutdown
exit
!
router ospf 1
router-id 10.4.254.18
area 4 nssa no-summary
passive-interface default
no passive-interface GigabitEthernet0/0.15
no passive-interface GigabitEthernet0/1.300
network 10.4.254.4 0.0.0.3 area 4
network 10.4.254.8 0.0.0.3 area 4
network 10.4.254.16 0.0.0.3 area 4
network 31.4.126.12 0.0.0.3 area 4
redistribute static subnets
redistribute bgp 65416 subnets route-map BGP-TO-OSPF
exit
!
router bgp 65416
bgp router-id 10.4.254.18
bgp log-neighbor-changes
neighbor 10.4.254.9 remote-as 65416
neighbor 10.4.254.9 description iBGP-TO-EDGE1
neighbor 10.4.254.9 update-source GigabitEthernet0/1.300
neighbor 31.4.126.14 remote-as 65430
neighbor 31.4.126.14 description eBGP-TO-WANRTR
address-family ipv4
network 191.4.157.32 mask 255.255.255.240
network 217.4.160.0 mask 255.255.255.0
neighbor 10.4.254.9 activate
neighbor 10.4.254.9 next-hop-self
neighbor 31.4.126.14 activate
neighbor 31.4.126.14 route-map PREPEND-OUT out
exit-address-family
exit
!
ip access-list extended NAT-ACL
permit ip 10.4.0.0 0.0.255.255 any
permit ip 10.116.4.0 0.0.0.3 any
exit
!
ip nat inside source list NAT-ACL interface GigabitEthernet0/0.16 overload
ip nat inside source static tcp 10.4.10.2 443 191.4.157.34 4443 extendable
ip nat inside source static tcp 10.4.10.3 80 191.4.157.34 80 extendable
ip nat inside source static tcp 10.4.10.3 443 191.4.157.34 443 extendable
!
ip route 10.4.0.0 255.255.0.0 10.4.254.6
ip route 191.4.157.32 255.255.255.240 Null0
ip route 217.4.160.0 255.255.255.0 Null0
!
ip access-list extended SSH-ACCESS
permit tcp 10.4.99.0 0.0.0.255 any eq 22
deny tcp any any eq 22 log
permit ip any any
exit
!
ip prefix-list INTERNET-PREFIX seq 10 permit 8.8.4.0/29
!
route-map PREPEND-OUT permit 10
set as-path prepend 65416 65416
exit
!
route-map BGP-TO-OSPF permit 10
match ip address prefix-list INTERNET-PREFIX
exit
!
no ip http server
no ip http secure-server
!
banner login ^
/!\ Restricted access. Only for authorized people /!\
^
!
line con 0
logging synchronous
exit
!
line vty 0 4
access-class SSH-ACCESS in
exec-timeout 5 0
absolute-timeout 20
login local
transport input ssh
exit
!
end
write memory
